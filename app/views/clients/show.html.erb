
<% content_for :page_title, @client.name %>

<div class="py-8">
  <!-- Breadcrumb -->
  <nav class="mb-6">
    <ol class="flex items-center space-x-2 text-sm text-gray-500">
      <li><%= link_to "Dashboard", root_path, class: "hover:text-gray-700" %></li>
      <li><span class="mx-2">/</span></li>
      <li><%= link_to "Clientes", clients_path, class: "hover:text-gray-700" %></li>
      <li><span class="mx-2">/</span></li>
      <li class="text-gray-900 font-medium"><%= @client.name %></li>
    </ol>
  </nav>

  <!-- Header do Cliente -->
  <div class="bg-white shadow-xl rounded-lg p-8 mb-8">
    <div class="flex items-center justify-between mb-6">
      <div>
        <h1 class="text-3xl font-bold text-gray-900"><%= @client.name %></h1>
        <p class="text-gray-600 mt-2">Cliente desde <%= @client.created_at.strftime("%B de %Y") %></p>
      </div>
      <div class="flex space-x-3">
        <%= link_to edit_client_path(@client), 
            class: "bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 flex items-center" do %>
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
          </svg>
          Editar
        <% end %>
        <%= link_to client_path(@client), 
            data: { 
              "turbo-method": :delete,
              "turbo-confirm": "Tem certeza que deseja excluir este cliente?"
            },
            class: "bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 flex items-center" do %>
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
          </svg>
          Excluir
        <% end %>
      </div>
    </div>
  </div>

  <!-- Tabs Navigation -->
  <div class="bg-white shadow-xl rounded-lg mb-8">
    <div class="border-b border-gray-200">
      <nav class="flex px-6" aria-label="Tabs">
        <button class="tab-button group relative min-w-0 flex-1 overflow-hidden bg-white py-4 px-4 text-center text-sm font-medium text-gray-500 hover:bg-gray-50 hover:text-gray-700 focus:z-10 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-inset border-b-2 border-transparent transition-all duration-200" data-tab="info">
          <div class="flex items-center justify-center space-x-3">
            <svg class="w-5 h-5 text-gray-400 group-hover:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
            </svg>
            <span class="font-medium">Informações</span>
          </div>
        </button>
        <button class="tab-button group relative min-w-0 flex-1 overflow-hidden bg-white py-4 px-4 text-center text-sm font-medium text-gray-500 hover:bg-gray-50 hover:text-gray-700 focus:z-10 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-inset border-b-2 border-transparent transition-all duration-200" data-tab="payments">
          <div class="flex items-center justify-center space-x-3">
            <svg class="w-5 h-5 text-gray-400 group-hover:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
            </svg>
            <span class="font-medium">Pagamentos</span>
          </div>
        </button>
        <button class="tab-button group relative min-w-0 flex-1 overflow-hidden bg-white py-4 px-4 text-center text-sm font-medium text-gray-500 hover:bg-gray-50 hover:text-gray-700 focus:z-10 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-inset border-b-2 border-transparent transition-all duration-200" data-tab="measurements">
          <div class="flex items-center justify-center space-x-3">
            <svg class="w-5 h-5 text-gray-400 group-hover:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
            </svg>
            <span class="font-medium">Medidas</span>
          </div>
        </button>
        <button class="tab-button group relative min-w-0 flex-1 overflow-hidden bg-white py-4 px-4 text-center text-sm font-medium text-gray-500 hover:bg-gray-50 hover:text-gray-700 focus:z-10 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-inset border-b-2 border-transparent transition-all duration-200" data-tab="skinfolds">
          <div class="flex items-center justify-center space-x-3">
            <svg class="w-5 h-5 text-gray-400 group-hover:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <span class="font-medium">Dobras Cutâneas</span>
          </div>
        </button>
      </nav>
    </div>

    <!-- Tab Content: Informações Pessoais -->
    <div id="info" class="tab-pane" style="display: block;">
      <div class="p-8">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="bg-gray-50 p-4 rounded-lg">
          <label class="block text-sm font-medium text-gray-700 mb-1">Data de Nascimento</label>
          <p class="text-gray-900 font-semibold">
            <%= @client.birthdate&.strftime("%d/%m/%Y") || "Não informado" %>
          </p>
        </div>
        
        <div class="bg-gray-50 p-4 rounded-lg">
          <label class="block text-sm font-medium text-gray-700 mb-1">Idade</label>
          <p class="text-gray-900 font-semibold">
            <% if @client.birthdate %>
              <%= ((Time.current - @client.birthdate.to_time) / 1.year.seconds).floor %> anos
            <% else %>
              Não informado
            <% end %>
          </p>
        </div>
        
        <div class="bg-gray-50 p-4 rounded-lg">
          <label class="block text-sm font-medium text-gray-700 mb-1">Telefone</label>
          <p class="text-gray-900 font-semibold"><%= @client.cellphone || "Não informado" %></p>
        </div>
        
        <div class="bg-gray-50 p-4 rounded-lg">
          <label class="block text-sm font-medium text-gray-700 mb-1">Gênero</label>
          <p class="text-gray-900 font-semibold">
            <%= case @client.gender
                when 'M' then 'Masculino'
                when 'F' then 'Feminino'
                when 'O' then 'Outro'
                else 'Não informado'
                end %>
          </p>
        </div>
        
        <div class="bg-gray-50 p-4 rounded-lg md:col-span-2">
          <label class="block text-sm font-medium text-gray-700 mb-1">Endereço</label>
          <p class="text-gray-900 font-semibold"><%= @client.address || "Não informado" %></p>
        </div>
        
        <div class="bg-gradient-to-r from-red-50 to-red-100 p-4 rounded-lg border border-red-200">
          <label class="block text-sm font-medium text-red-700 mb-1">Próximo Vencimento</label>
          <div class="flex items-center justify-between">
            <% if @day_of_payment %>
              <p class="text-red-900 font-bold text-lg"><%= @day_of_payment.strftime("%d/%m/%Y") %></p>
              <%= link_to new_client_payment_path(@client), 
                  class: "bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 flex items-center" do %>
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                </svg>
                Antecipar Pagamento
              <% end %>
            <% else %>
              <p class="text-gray-600">Nenhum pagamento registrado</p>
              <%= link_to new_client_payment_path(@client), 
                  class: "bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 flex items-center" do %>
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                </svg>
                Registrar Primeiro Pagamento
              <% end %>
            <% end %>
          </div>
        </div>
        
        <!-- IMC Atual -->
        <% if @current_imc %>
          <div class="bg-gradient-to-r from-blue-50 to-blue-100 p-4 rounded-lg border border-blue-200">
            <label class="block text-sm font-medium text-blue-700 mb-1">IMC Atual</label>
            <div class="flex items-center justify-between">
              <div>
                <p class="text-blue-900 font-bold text-2xl"><%= @current_imc %></p>
                <p class="<%= @imc_classification[:color] %> font-medium"><%= @imc_classification[:category] %></p>
              </div>
              <div class="text-xs text-blue-600">
                <p>Altura: <%= @latest_measurement.height %> cm</p>
                <p>Peso: <%= @latest_measurement.weight %> kg</p>
              </div>
            </div>
          </div>
        <% end %>
        </div>
      </div>
    </div>
    
    <!-- Payments Tab Content -->
    <div id="payments" class="tab-pane hidden" style="display: none;">
      <div class="p-6">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-xl font-semibold text-gray-900">Últimos Pagamentos</h3>
          <div class="flex space-x-3" style="display: flex !important; gap: 12px; visibility: visible !important;">
            <%= link_to client_payments_path(@client), 
                class: "bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 flex items-center",
                style: "display: flex !important; visibility: visible !important;" do %>
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
              </svg>
              Ver Todos
            <% end %>
            <%= link_to new_client_payment_path(@client), 
                class: "bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 flex items-center",
                style: "display: flex !important; visibility: visible !important;" do %>
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
              </svg>
              Novo Pagamento
            <% end %>
          </div>
        </div>
        
        <% if @client_payments && @client_payments.any? %>
          <div class="overflow-x-auto">
            <table class="w-full divide-y divide-gray-200 rounded-lg overflow-hidden">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Valor</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                <% @client_payments.each_with_index do |payment, index| %>
                  <tr class="<%= index.even? ? 'bg-white' : 'bg-gray-50' %> hover:bg-blue-50 transition duration-150">
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                      <%= payment.payment_date.strftime("%d/%m/%Y") %>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600">
                      <%= number_to_currency(payment.value, unit: "R$ ", separator: ",", delimiter: "") %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
          
          <% if @client.payments.count > 10 %>
            <div class="mt-4 text-center">
              <p class="text-sm text-gray-500 mb-2">
                Mostrando os 10 pagamentos mais recentes de <%= @client.payments.count %> no total
              </p>
            </div>
          <% end %>
        <% else %>
          <div class="text-center py-12">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
            </svg>
            <h3 class="mt-2 text-sm font-medium text-gray-900">Nenhum pagamento registrado</h3>
            <p class="mt-1 text-sm text-gray-500">Comece registrando o primeiro pagamento do cliente.</p>
          </div>
        <% end %>
      </div>
    </div>
    
    <!-- Measurements Tab Content -->
    <div id="measurements" class="tab-pane hidden" style="display: none;">
      <div class="p-6">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-xl font-semibold text-gray-900">Medidas e Evolução</h3>
          <div class="flex space-x-3" style="display: flex !important; gap: 12px; visibility: visible !important;">
            <%= link_to client_measurements_path(@client), 
                class: "bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 flex items-center",
                style: "display: flex !important; visibility: visible !important;" do %>
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
              </svg>
              Ver Todas
            <% end %>
            <%= link_to new_client_measurement_path(@client), 
                class: "bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 flex items-center",
                style: "display: flex !important; visibility: visible !important;" do %>
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
              </svg>
              Nova Medida
            <% end %>
          </div>
        </div>

        <% if @client_measurements && @client_measurements.any? %>
          <!-- Gráfico de Evolução das Medidas -->
          <div class="mb-8">
            <div class="bg-white rounded-lg border border-gray-200 p-6">
              <h4 class="text-lg font-semibold text-gray-900 mb-4">Evolução das Principais Medidas</h4>
              <div class="h-80">
                <canvas id="measurementsChart"></canvas>
              </div>
            </div>
          </div>

          <!-- Lista das Últimas Medidas -->
          <div class="space-y-4">
            <% @client_measurements.each_with_index do |measurement, index| %>
              <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition duration-150 <%= index == 0 ? 'ring-2 ring-blue-200' : '' %>">
                <div class="flex items-center justify-between mb-3">
                  <h4 class="text-lg font-medium text-gray-900">
                    <%= measurement.created_at.strftime("%d/%m/%Y") %>
                    <% if index == 0 %>
                      <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                        Mais Recente
                      </span>
                    <% end %>
                  </h4>
                </div>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                  <div>
                    <span class="font-medium text-gray-500">Peso:</span>
                    <p class="text-gray-900 font-semibold"><%= measurement.weight || "-" %> kg</p>
                  </div>
                  <div>
                    <span class="font-medium text-gray-500">Altura:</span>
                    <p class="text-gray-900"><%= measurement.height || "-" %> cm</p>
                  </div>
                  <div>
                    <span class="font-medium text-gray-500">Braço Esq:</span>
                    <p class="text-gray-900"><%= measurement.left_arm || "-" %> cm</p>
                  </div>
                  <div>
                    <span class="font-medium text-gray-500">Braço Dir:</span>
                    <p class="text-gray-900"><%= measurement.right_arm || "-" %> cm</p>
                  </div>
                  <div>
                    <span class="font-medium text-gray-500">Coxa Esq:</span>
                    <p class="text-gray-900"><%= measurement.left_thigh || "-" %> cm</p>
                  </div>
                  <div>
                    <span class="font-medium text-gray-500">Coxa Dir:</span>
                    <p class="text-gray-900"><%= measurement.righ_thigh || "-" %> cm</p>
                  </div>
                  <div>
                    <span class="font-medium text-gray-500">Peito:</span>
                    <p class="text-gray-900"><%= measurement.chest || "-" %> cm</p>
                  </div>
                  <div>
                    <span class="font-medium text-gray-500">Cintura:</span>
                    <p class="text-gray-900"><%= measurement.waist || "-" %> cm</p>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
          
          <% if @client.measurements.count > 10 %>
            <div class="mt-6 text-center">
              <p class="text-sm text-gray-500 mb-2">
                Mostrando as 10 medidas mais recentes de <%= @client.measurements.count %> no total
              </p>
            </div>
          <% end %>
        <% else %>
          <div class="text-center py-12">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
            </svg>
            <h3 class="mt-2 text-sm font-medium text-gray-900">Nenhuma medida registrada</h3>
            <p class="mt-1 text-sm text-gray-500">Registre a primeira medida para acompanhar a evolução.</p>
          </div>
        <% end %>
      </div>
    </div>
    
    <!-- Skinfolds Tab Content -->
    <div id="skinfolds" class="tab-pane hidden" style="display: none;">
      <div class="p-6">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-xl font-semibold text-gray-900">Dobras Cutâneas e Evolução</h3>
          <div class="flex space-x-3" style="display: flex !important; gap: 12px; visibility: visible !important;">
            <%= link_to client_skinfolds_path(@client), 
                class: "bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 flex items-center",
                style: "display: flex !important; visibility: visible !important;" do %>
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
              </svg>
              Ver Todas
            <% end %>
            <%= link_to new_client_skinfold_path(@client), 
                class: "bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 flex items-center",
                style: "display: flex !important; visibility: visible !important;" do %>
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
              </svg>
              Nova Medição
            <% end %>
          </div>
        </div>
        
        <% if @client_skinfolds && @client_skinfolds.any? %>
          <!-- Gráfico de Evolução das Dobras -->
          <div class="mb-8">
            <div class="bg-white rounded-lg border border-gray-200 p-6">
              <h4 class="text-lg font-semibold text-gray-900 mb-4">Evolução das Dobras Cutâneas</h4>
              <div class="h-80">
                <canvas id="skinfoldsChart"></canvas>
              </div>
            </div>
          </div>

          <!-- Lista das Últimas Dobras -->
          <div class="space-y-4">
            <% @client_skinfolds.each_with_index do |skinfold, index| %>
              <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition duration-150 <%= index == 0 ? 'ring-2 ring-blue-200' : '' %>">
                <div class="flex items-center justify-between mb-3">
                  <h4 class="text-lg font-medium text-gray-900">
                    <%= skinfold.created_at.strftime("%d/%m/%Y") %>
                    <% if index == 0 %>
                      <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                        Mais Recente
                      </span>
                    <% end %>
                  </h4>
                  <% if skinfold.tricep && skinfold.subscapular && skinfold.suprailiac %>
                    <div class="text-sm">
                      <span class="font-medium text-gray-500">Soma 3 dobras:</span>
                      <span class="font-semibold text-blue-600"><%= (skinfold.tricep + skinfold.subscapular + skinfold.suprailiac).round(1) %> mm</span>
                    </div>
                  <% end %>
                </div>
                
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4 text-sm">
                  <div>
                    <span class="font-medium text-gray-500">Tríceps:</span>
                    <p class="text-gray-900 font-semibold"><%= skinfold.tricep || "-" %> mm</p>
                  </div>
                  <div>
                    <span class="font-medium text-gray-500">Bíceps:</span>
                    <p class="text-gray-900"><%= skinfold.bicep || "-" %> mm</p>
                  </div>
                  <div>
                    <span class="font-medium text-gray-500">Subescapular:</span>
                    <p class="text-gray-900 font-semibold"><%= skinfold.subscapular || "-" %> mm</p>
                  </div>
                  <div>
                    <span class="font-medium text-gray-500">Supra-ilíaca:</span>
                    <p class="text-gray-900 font-semibold"><%= skinfold.suprailiac || "-" %> mm</p>
                  </div>
                  <div>
                    <span class="font-medium text-gray-500">Abdominal:</span>
                    <p class="text-gray-900"><%= skinfold.abdominal || "-" %> mm</p>
                  </div>
                  <div>
                    <span class="font-medium text-gray-500">Coxa:</span>
                    <p class="text-gray-900"><%= skinfold.thigh || "-" %> mm</p>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
          
          <% if @client.skinfolds.count > 10 %>
            <div class="mt-6 text-center">
              <p class="text-sm text-gray-500 mb-2">
                Mostrando as 10 medidas mais recentes de <%= @client.skinfolds.count %> no total
              </p>
            </div>
          <% end %>
        <% else %>
          <div class="text-center py-12">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
            </svg>
            <h3 class="mt-2 text-sm font-medium text-gray-900">Nenhuma dobra cutânea registrada</h3>
            <p class="mt-1 text-sm text-gray-500">Registre a primeira medição para acompanhar a evolução da composição corporal.</p>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  /* Tab system styles */
  .tab-pane {
    display: block;
  }
  
  .tab-pane.hidden {
    display: none !important;
  }
  
  /* Force button visibility */
  .flex.space-x-3,
  .flex.space-x-3 > *,
  .flex.space-x-3 a {
    display: flex !important;
    visibility: visible !important;
    opacity: 1 !important;
  }
  
  /* Force all buttons to be visible */
  a[class*="bg-gray-500"],
  a[class*="bg-blue-500"],
  a[class*="bg-green-500"] {
    display: flex !important;
    visibility: visible !important;
    opacity: 1 !important;
  }
  
  /* Ensure tab functionality */
  .tab-button {
    cursor: pointer;
  }
  
  .tab-button:hover {
    background-color: #f9fafb !important;
  }
  
  /* Pagination styles */
  .pagination {
    display: flex;
    list-style: none;
    margin: 0;
    padding: 0;
    align-items: center;
    justify-content: center;
    gap: 0.25rem;
  }
  
  .pagination li {
    margin: 0;
  }
  
  .pagination a,
  .pagination em,
  .pagination span {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 2.5rem;
    height: 2.5rem;
    padding: 0.5rem 1rem;
    text-decoration: none;
    font-size: 0.875rem;
    font-weight: 500;
    border: 1px solid #d1d5db;
    border-radius: 0.375rem;
    transition: all 0.15s ease-in-out;
    color: #374151;
    background-color: white;
  }
  
  .pagination a:hover {
    background-color: #f3f4f6;
    border-color: #9ca3af;
    color: #1f2937;
  }
  
  .pagination .current,
  .pagination em {
    color: white;
    background-color: #3b82f6;
    border-color: #3b82f6;
    font-style: normal;
    font-weight: 600;
  }
  
  .pagination .gap {
    color: #6b7280;
    background: transparent;
    border: none;
    cursor: default;
  }
  
  .pagination .previous_page,
  .pagination .next_page {
    font-weight: 600;
    padding: 0.5rem 1.5rem;
  }
  
  .pagination .disabled {
    color: #9ca3af;
    cursor: not-allowed;
    background-color: #f9fafb;
    border-color: #e5e7eb;
  }
  
  .pagination .disabled:hover {
    background-color: #f9fafb;
    border-color: #e5e7eb;
    color: #9ca3af;
  }
</style>

<script>
// Ensure DOM is fully loaded before initializing
function initializeTabs() {
  console.log('DOM loaded - initializing tabs');
  
  // Chart variables
  let measurementsChart;
  let skinfoldsChart;
  
  function showTab(targetId) {
    console.log('showTab called with:', targetId);
    
    // Hide all tab panes using display style
    const tabPanes = document.querySelectorAll('.tab-pane');
    console.log('Found tab panes:', tabPanes.length);
    tabPanes.forEach(pane => {
      pane.style.display = 'none';
      pane.classList.add('hidden');
    });
    
    // Remove active state from all tabs
    const tabButtons = document.querySelectorAll('.tab-button');
    console.log('Found tab buttons:', tabButtons.length);
    tabButtons.forEach(tab => {
      tab.classList.remove('bg-blue-50', 'text-blue-600', 'border-blue-500');
      tab.classList.add('text-gray-500', 'border-transparent');
      
      const icon = tab.querySelector('svg');
      if (icon) {
        icon.classList.remove('text-blue-500');
        icon.classList.add('text-gray-400');
      }
    });
    
    // Show target tab pane using display style
    const targetPane = document.getElementById(targetId);
    if (targetPane) {
      targetPane.style.display = 'block';
      targetPane.classList.remove('hidden');
      console.log('Showed tab:', targetId);
    } else {
      console.log('Target pane not found:', targetId);
    }
    
    // Activate target tab button
    const activeTab = document.querySelector(`[data-tab="${targetId}"]`);
    if (activeTab) {
      activeTab.classList.add('bg-blue-50', 'text-blue-600', 'border-blue-500');
      activeTab.classList.remove('text-gray-500', 'border-transparent');
      
      const activeIcon = activeTab.querySelector('svg');
      if (activeIcon) {
        activeIcon.classList.add('text-blue-500');
        activeIcon.classList.remove('text-gray-400');
      }
      console.log('Activated tab button:', activeTab);
    } else {
      console.log('Active tab button not found:', targetId);
    }
    
    // Initialize charts when needed
    if (targetId === 'measurements') {
      setTimeout(() => initializeMeasurementsChart(), 250);
    } else if (targetId === 'skinfolds') {
      setTimeout(() => initializeSkinfoldsChart(), 250);
    }
  }
  
  function initializeMeasurementsChart() {
    const canvas = document.getElementById('measurementsChart');
    if (!canvas) return;
    
    // Destroy existing chart
    if (measurementsChart) {
      measurementsChart.destroy();
    }
    
    const ctx = canvas.getContext('2d');
    <% if defined?(@measurements_chart_data) && @measurements_chart_data %>
      const measurementsData = <%= raw @measurements_chart_data.to_json %>;
    <% else %>
      const measurementsData = { labels: [], weight: [], chest: [], waist: [] };
    <% end %>
    
    if (!measurementsData || measurementsData.labels.length === 0) {
      canvas.parentElement.innerHTML = '<div class="flex items-center justify-center h-80 text-gray-500"><p>Não há dados suficientes para exibir o gráfico</p></div>';
      return;
    }
    
    measurementsChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: measurementsData.labels,
        datasets: [
          {
            label: 'Peso (kg)',
            data: measurementsData.weight,
            borderColor: 'rgb(59, 130, 246)',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            tension: 0.1,
            fill: true
          },
          {
            label: 'Peito (cm)',
            data: measurementsData.chest,
            borderColor: 'rgb(34, 197, 94)',
            backgroundColor: 'rgba(34, 197, 94, 0.1)',
            tension: 0.1,
            fill: false
          },
          {
            label: 'Cintura (cm)',
            data: measurementsData.waist,
            borderColor: 'rgb(239, 68, 68)',
            backgroundColor: 'rgba(239, 68, 68, 0.1)',
            tension: 0.1,
            fill: false
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: { beginAtZero: false },
          x: {}
        }
      }
    });
  }
  
  function initializeSkinfoldsChart() {
    const canvas = document.getElementById('skinfoldsChart');
    if (!canvas) return;
    
    // Destroy existing chart
    if (skinfoldsChart) {
      skinfoldsChart.destroy();
    }
    
    const ctx = canvas.getContext('2d');
    <% if defined?(@skinfolds_chart_data) && @skinfolds_chart_data %>
      const skinfoldsData = <%= raw @skinfolds_chart_data.to_json %>;
    <% else %>
      const skinfoldsData = { labels: [], tricep: [], subscapular: [], suprailiac: [], sum: [] };
    <% end %>
    
    if (!skinfoldsData || skinfoldsData.labels.length === 0) {
      canvas.parentElement.innerHTML = '<div class="flex items-center justify-center h-80 text-gray-500"><p>Não há dados suficientes para exibir o gráfico</p></div>';
      return;
    }
    
    skinfoldsChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: skinfoldsData.labels,
        datasets: [
          {
            label: 'Tríceps (mm)',
            data: skinfoldsData.tricep,
            borderColor: 'rgb(168, 85, 247)',
            backgroundColor: 'rgba(168, 85, 247, 0.1)',
            tension: 0.1,
            fill: false
          },
          {
            label: 'Subescapular (mm)',
            data: skinfoldsData.subscapular,
            borderColor: 'rgb(34, 197, 94)',
            backgroundColor: 'rgba(34, 197, 94, 0.1)',
            tension: 0.1,
            fill: false
          },
          {
            label: 'Supra-ilíaca (mm)',
            data: skinfoldsData.suprailiac,
            borderColor: 'rgb(249, 115, 22)',
            backgroundColor: 'rgba(249, 115, 22, 0.1)',
            tension: 0.1,
            fill: false
          },
          {
            label: 'Soma 3 dobras (mm)',
            data: skinfoldsData.sum,
            borderColor: 'rgb(239, 68, 68)',
            backgroundColor: 'rgba(239, 68, 68, 0.1)',
            tension: 0.1,
            fill: true,
            borderWidth: 3
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: { beginAtZero: true },
          x: {}
        }
      }
    });
  }
  
  // Make showTab globally available for debug buttons
  window.showTab = showTab;
  
  // Determine active tab on page load
  function getActiveTab() {
    const hash = window.location.hash.slice(1);
    if (['info', 'payments', 'measurements', 'skinfolds'].includes(hash)) {
      return hash;
    }
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.has('payments_page')) return 'payments';
    if (urlParams.has('measurements_page')) return 'measurements';
    if (urlParams.has('skinfolds_page')) return 'skinfolds';
    return 'info';
  }
  
  // Initialize page
  const initialTab = getActiveTab();
  console.log('Initial tab:', initialTab);
  showTab(initialTab);
  
  // Add click handlers to tabs
  const tabButtons = document.querySelectorAll('.tab-button');
  console.log('Adding click handlers to', tabButtons.length, 'buttons');
  
  tabButtons.forEach((tab, index) => {
    const tabId = tab.getAttribute('data-tab');
    console.log(`Adding click handler to tab ${index}: ${tabId}`);
    
    tab.addEventListener('click', function(e) {
      console.log('Tab clicked:', tabId);
      e.preventDefault();
      e.stopPropagation();
      showTab(tabId);
      window.location.hash = tabId;
    });
  });
  
  // Handle hash changes
  window.addEventListener('hashchange', function() {
    const activeTab = getActiveTab();
    console.log('Hash changed, showing tab:', activeTab);
    showTab(activeTab);
  });
  
  console.log('Tab initialization complete');
}

// Multiple event listeners to ensure initialization
document.addEventListener('DOMContentLoaded', initializeTabs);
window.addEventListener('load', initializeTabs);

// Also try immediate execution if DOM is already ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initializeTabs);
} else {
  setTimeout(initializeTabs, 100);
}
</script>